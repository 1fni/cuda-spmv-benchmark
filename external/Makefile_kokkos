KOKKOS_PATH = $(CURDIR)/kokkos-install
KOKKOSKERNELS_PATH = $(CURDIR)/kokkos-kernels-install

CXX = nvcc
CXXFLAGS = -std=c++17 -O3 -x cu --expt-extended-lambda -arch=sm_70 -I$(KOKKOS_PATH)/include -I$(KOKKOSKERNELS_PATH)/include -I$(KOKKOSKERNELS_PATH)/../kokkos-kernels/test_common -I$(KOKKOSKERNELS_PATH)/../kokkos-kernels/perf_test/sparse
NVCCFLAGS = --ptxas-options=-O3 --ptxas-options=-allow-expensive-optimizations=true
LDFLAGS = -L$(KOKKOS_PATH)/lib -L$(KOKKOSKERNELS_PATH)/lib -lkokkoskernels -lkokkoscontainers -lkokkoscore -lkokkossimd -lcudart -lcusparse -lcublas -lcuda -lpthread -ldl

all: kokkos_bench kokkos_struct kokkos_cg_baseline kokkos_cg_struct generate_kokkos_matrix

kokkos_bench: kokkos_spmv_bench.cpp
	$(CXX) $(CXXFLAGS) $(NVCCFLAGS) $< -o $@ $(LDFLAGS)

kokkos_struct: kokkos_spmv_struct.cpp
	$(CXX) $(CXXFLAGS) $(NVCCFLAGS) $< -o $@ $(LDFLAGS)

kokkos_cg_baseline: kokkos_cg_baseline.cpp
	$(CXX) $(CXXFLAGS) $(NVCCFLAGS) $< -o $@ $(LDFLAGS)

kokkos_cg_struct: kokkos_cg_struct.cpp
	$(CXX) $(CXXFLAGS) $(NVCCFLAGS) $< -o $@ $(LDFLAGS)

generate_kokkos_matrix: generate_kokkos_matrix.cpp
	$(CXX) $(CXXFLAGS) $(NVCCFLAGS) $< -o $@ $(LDFLAGS)

clean:
	rm -f kokkos_bench kokkos_struct kokkos_cg_baseline kokkos_cg_struct generate_kokkos_matrix

.PHONY: all clean
